Parse.initialize("pipeeroAppId","pipeeroJavascriptKey"),Parse.serverURL="http://localhost:1337/parse",angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","gridster","ui.bootstrap.modal","btford.socket-io","ngLodash","angular-progress-arc","angular.directives-round-progress","ngStorage"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,r){e.otherwise("/dashboard"),t.state("index",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}).state("tables",{url:"/tables",templateUrl:"templates/tables.html"}).state("login",{url:"/login",templateUrl:"templates/login.html"})}]).run(["$rootScope","$http","$location","$localStorage",function(t,e,r,o){console.log("run"),o.currentUser&&(e.defaults.headers.common["x-access-token"]=o.currentUser.token),t.$on("$locationChangeStart",function(t,e,a){var l=["/login"],n=l.indexOf(r.path())===-1;n&&!o.currentUser&&r.path("/login")})}]);
function AlertsCtrl(e){e.alerts=[{type:"success",msg:"Thanks for visiting! Feel free to create pull requests to improve the dashboard!"},{type:"danger",msg:"Found a bug? Create an issue with as many details as you can."}],e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function DashboardCtrl(e,t,n,o,i,s,a,r,c){function l(t){a.getWidgets(g).then(function(n){e.standardItems=n,t&&s.forEach(n,function(e,t){i.emit("subscribe",{topic:"sub/"+g+"/"+e.thingId})})},function(e){})}function d(t){var n={sizeX:1,sizeY:1};t.owner=g,t.widgetInfo=n,a.createWidget(g,t).then(function(t){e.alertMessage={message:"Successfully Added a Widget",type:"success"},l()},function(e){})}function u(e){if(e["delete"])console.log("delete!"),console.log(e),a.deleteWidgetById(g,e.id,e).then(function(e){l()},function(e){console.log("error")});else{console.log(e);var t=e.id;delete e.id,a.updateWidgetById(g,t,e).then(function(e){l()},function(e){})}}var g="";r.currentUser&&(g=r.currentUser.info.id),e.size=120,e.progress=.5,e.strokeWidth=20,e.stroke="#1abc9c",e.background="lightgrey",e.counterClockwise="",e.roundProgressData={label:80,percentage:.11},e.$watch("roundProgressData",function(e,t){e.percentage=e.label/100},!0),i.on("connect",function(){console.log("socket connect"),l(!0)}),i.on("server-to-client",function(t){var n=t.topic;n=n.split("/"),n=n[2];var o=s.findIndex(e.standardItems,function(e){return e.thingId===n});e.standardItems[o].inputValue=t.payload}),e.alertShow=!1,e.closeAlert=function(){e.alertShow=!1},l(!0),e.gridsterOpts={floating:!1,resizable:{enabled:!0,handles:["n","e","s","w","ne","se","sw","nw"],start:function(e,t,n){},resize:function(e,t,n){},stop:function(t,n,o){console.log(o),e.saveWidgets()}},draggable:{enabled:!0,handle:".my-class",start:function(e,t,n){},drag:function(e,t,n){},stop:function(t,n,o){console.log(o),e.saveWidgets()}}},e.customItemMap={sizeX:"item.widgetInfo.sizeX",sizeY:"item.widgetInfo.sizeY",row:"item.widgetInfo.row",col:"item.widgetInfo.col",minSizeY:"item.minSizeY",maxSizeY:"item.maxSizeY"},e.standardItems2=[{attributes:{name:"box1",widgetInfo:{sizeX:6,sizeY:1,row:0,col:0}}},{attributes:{name:"box2",widgetInfo:{sizeX:2,sizeY:2,row:0,col:2}}}],e.executeButton=function(e){console.log(e),i.emit("publish",{topic:"pub/"+g+"/"+e._id,payload:e.payload})},e.saveWidgets=function(){angular.forEach(e.standardItems,function(e,t){console.log(e);var n={widgetInfo:e.widgetInfo};a.updateWidgetById(g,e._id,n).then(function(e){},function(e){})}),e.alertShow=!0,e.alertMessage={message:"Successfully Saved!",type:"success"},c(function(){e.alertShow=!1},2e3)},e.addThing=function(e){var t=n.open({animation:!1,templateUrl:"templates/thingModal.html",controller:"ThingModalCtrl",resolve:{items:function(){return!1}}});t.result.then(function(e){d(e)},function(){})},e.openSettings=function(e){console.log(e);var t=n.open({animation:!1,templateUrl:"templates/thingModal.html",controller:"ThingModalCtrl",resolve:{items:function(){return e}}});t.result.then(function(e){u(e)},function(){})}}angular.module("RDash").controller("DashboardCtrl",["$scope","$cookieStore","$uibModal","thingService","socket","lodash","widgetService","$localStorage","$timeout",DashboardCtrl]);
function MasterCtrl(e,o,n,s,i,t,a){var g=992;e.user={email:"",password:""},e.isLoggedIn=!1,s.currentUser?(e.isLoggedIn=!0,e.username=s.currentUser.info.name):e.username="pipeero",e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(n,s){n>=g?angular.isDefined(o.get("toggle"))?e.toggle=!!o.get("toggle"):e.toggle=!0:e.toggle=!1}),e.doLogin=function(){e.isLoginLoading=!0,n.login(e.user).then(function(o){e.isLoginLoading=!1,o.success?(s.currentUser={info:o.data,token:o.token},i.defaults.headers.common["x-access-token"]=o.token,e.username=s.currentUser.info.name,t.path("/dashboard"),e.isLoggedIn=!0):(e.invalidLoginToaster=!0,e.loginAlertMessage={message:o.message})},function(e){console.log(e)})},e.doRegister=function(){e.isRegisterLoading=!0,n.signup(e.user).then(function(o){if(e.isRegisterLoading=!1,o.errors){e.invalidLoginToaster=!0;var a="";a=o.errors.password?"Invalid Password":"Email address already taken, or might be invalid.",e.loginAlertMessage={message:a}}else{var g={email:o.email,password:o.password};e.isRegisterLoading=!1,n.login(g).then(function(o){o.success?(s.currentUser={info:o.data,token:o.token},i.defaults.headers.common["x-access-token"]=o.token,t.path("/dashboard"),e.isLoggedIn=!0,e.isLoginLoading=!1):(e.invalidLoginToaster=!0,e.loginAlertMessage={message:o.message},e.isLoginLoading=!1)},function(e){console.log(e)})}},function(o){console.log(o),e.isRegisterLoading=!1})},e.doLogout=function(){console.log("logout"),delete s.currentUser,console.log(s),i.defaults.headers.common["x-access-token"]="",e.isLoggedIn=!1,t.path("/login"),e.username="pipeero",a.location.reload()},e.closeLoginAlert=function(){e.invalidLoginToaster=!1},e.toggleSidebar=function(){e.toggle=!e.toggle,o.put("toggle",e.toggle)},window.onresize=function(){e.$apply()}}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","authenticationService","$localStorage","$http","$location","$window",MasterCtrl]);
function ThingModalCtrl(e,n,o,t){console.log(t);var a="57d6d72d7ee52c0300f3e8c6";"object"!=typeof o&&(e.showDeleteButton=!0,console.log("hey")),e.data={availableOptions:[{id:"1",name:"Input"},{id:"2",name:"Output"},{id:"3",name:"Graph"}],selectedOption:{id:"2",name:"Output"}},o?e.form={id:o._id,name:o.name,description:o.description,thingId:o.thingId,buttonLabel:o.buttonLabel,payload:o.payload,thingType:o.thingType}:e.form={},angular.forEach(e.data.availableOptions,function(n){n.name===o.thingType&&(e.data.selectedOption=n)}),e.generateThing=function(){var n={name:"default",owner:a,value:"default"};t.createThing(n).then(function(n){console.log(n),e.form.thingId=n._id},function(e){console.log("error")})},e.remove=function(){n.close(e.form),e.form["delete"]=!0},e.save=function(){console.log(e.data.selectedOption.name),e.form.thingType=e.data.selectedOption.name,n.close(e.form),e.form["delete"]=!1},e.dismiss=function(){n.dismiss("cancel")}}angular.module("RDash").controller("ThingModalCtrl",["$scope","$uibModalInstance","items","thingService",ThingModalCtrl]);
function justGage(i){return{restrict:"EA",scope:{id:"@","class":"@",min:"=",max:"=",title:"@",value:"=",options:"="},template:'<div id="{{id}}-justgage" class="{{class}}"></div>',link:function(t,e,a){i(function(){var i={id:t.id+"-justgage",min:t.min,max:t.max,title:t.title,value:t.value};if(t.options)for(var e in t.options)i[e]=t.options[e];var a=new JustGage(i);t.$watch("max",function(i){void 0!==i&&a.refresh(t.value,i)},!0),t.$watch("value",function(i){void 0!==i&&a.refresh(i)},!0)},1e3)}}}angular.module("RDash").directive("justGage",["$timeout",justGage]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);
angular.module("RDash").service("authenticationService",["$q","$http","$localStorage",function(e,t,r){function o(r){var o=e.defer();return console.log(r),t.post(i+"/pipe/authenticate",r).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function n(r){var o=e.defer();return console.log(r),t.post(i+"/pipe/user",r).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function s(){delete r.currentUser,t.defaults.headers.common.Authorization=""}var i="https://pipeero-rest-api.herokuapp.com",c={};return getUsers=function(r){var o=e.defer();return t.get(i+"/pipe/user").success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get Widgets")}),o.promise},c.login=o,c.signup=n,c.getUsers=getUsers,c.Logout=s,c}]);
angular.module("RDash").factory("socket",["socketFactory","$window",function(o){return console.log(o),o({prefix:"foo~",ioSocket:io.connect("https://pipeero-mqtt-ws.herokuapp.com")})}]);
angular.module("RDash").service("thingService",["$q","$http","$window",function(e,r){function t(t){var i=e.defer();return r.post(n+"/pipe/thing/",t).success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get the ")}),i.promise}var n="https://pipeero-rest-api.herokuapp.com",i=function(r){var t=e.defer(),n=Parse.Object.extend("Thing"),i=new Parse.Query(n);return i.find({success:function(e){t.resolve(e)},error:function(e){t.reject(e),alert("Error: "+e.code+" "+e.message)}}),t.promise};return{getThings:i,createThing:t}}]);
angular.module("RDash").service("widgetService",["$http","$q",function(e,t){function r(r){var i=t.defer();return e.get(c+"/pipe/"+r+"/widget").success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get Widgets")}),i.promise}function i(r,i,o){var n=t.defer();return e.put(c+"/pipe/"+r+"/widget/"+i,o).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function o(r,i,o){var n=t.defer();return console.log("delete widget!"),e["delete"](c+"/pipe/"+r+"/widget/"+i).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function n(r,i){var o=t.defer();return e.post(c+"/pipe/widget/",i).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}var c="https://pipeero-rest-api.herokuapp.com",s={getWidgets:r,updateWidgetById:i,createWidget:n,deleteWidgetById:o};return s}]);