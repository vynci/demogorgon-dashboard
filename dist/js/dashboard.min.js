Parse.initialize("pipeeroAppId","pipeeroJavascriptKey"),Parse.serverURL="http://localhost:1337/parse",angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","gridster","ui.bootstrap.modal","btford.socket-io","ngLodash","angular-progress-arc","angular.directives-round-progress","ngStorage"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,l){e.otherwise("/dashboard"),t.state("index",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}).state("discover",{url:"/discover",templateUrl:"templates/discover.html"}).state("about",{url:"/about",templateUrl:"templates/about.html"}).state("support",{url:"/support",templateUrl:"templates/support.html"}).state("things",{url:"/things",templateUrl:"templates/things.html",controller:"ThingCtrl"}).state("thingsData",{url:"/things/:thingId",templateUrl:"templates/thingsData.html",controller:"LogCtrl"}).state("settings",{url:"/settings",templateUrl:"templates/settings.html",controller:"SettingCtrl"}).state("login",{url:"/login",templateUrl:"templates/login.html"})}]).run(["$rootScope","$http","$location","$localStorage",function(t,e,l,r){console.log("run"),r.currentUser&&(e.defaults.headers.common["x-access-token"]=r.currentUser.token),t.$on("$locationChangeStart",function(t,e,o){var a=["/login","/about","/support","/discover"],s=a.indexOf(l.path())===-1;s&&!r.currentUser&&l.path("/login")})}]);
function AlertsCtrl(e){e.alerts=[{type:"success",msg:"Thanks for visiting! Feel free to create pull requests to improve the dashboard!"},{type:"danger",msg:"Found a bug? Create an issue with as many details as you can."}],e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function ConfirmationModalCtrl(o,n,i,l,a){console.log(i),o.warningMessage=i,o["delete"]=function(){n.close({confirmation:!0})},o.dismiss=function(){n.dismiss("cancel")}}angular.module("RDash").controller("ConfirmationModalCtrl",["$scope","$uibModalInstance","items","thingService","$localStorage",ConfirmationModalCtrl]);
function DashboardCtrl(e,t,n,o,i,a,s,r,c){function d(){i.on("connect",function(){}),i.on("server-to-client",function(t){var n=t.topic;n=n.split("/"),n=n[2];var o=a.findIndex(e.standardItems,function(e){return e.thingId===n});e.standardItems[o].inputValue=t.payload})}function l(t){s.getWidgets(g).then(function(n){e.standardItems=n,t&&a.forEach(n,function(e,t){i.emit("subscribe",{topic:"sub/"+g+"/"+e.thingId})})},function(e){}),d()}function u(t){var n={sizeX:1,sizeY:1};t.owner=g,t.widgetInfo=n,s.createWidget(g,t).then(function(t){e.alertMessage={message:"Successfully Added a Widget",type:"success"},l()},function(e){})}function f(e){if(e["delete"])s.deleteWidgetById(g,e.id,e).then(function(e){l()},function(e){});else{var t=e.id;delete e.id,s.updateWidgetById(g,t,e).then(function(e){l()},function(e){})}}console.log("dashboard!");var g="";r.currentUser&&(g=r.currentUser.info.id),e.size=120,e.progress=.5,e.strokeWidth=20,e.stroke="#1abc9c",e.background="lightgrey",e.counterClockwise="",e.roundProgressData={label:80,percentage:.11},e.$on("$locationChangeStart",function(e,t){console.log("next")}),e.alertShow=!1,e.closeAlert=function(){e.alertShow=!1},l(!0),e.gridsterOpts={floating:!1,resizable:{enabled:!0,handles:["n","e","s","w","ne","se","sw","nw"],start:function(e,t,n){},resize:function(e,t,n){},stop:function(t,n,o){e.saveWidgets()}},draggable:{enabled:!0,handle:".my-class",start:function(e,t,n){},drag:function(e,t,n){},stop:function(t,n,o){e.saveWidgets()}}},e.customItemMap={sizeX:"item.widgetInfo.sizeX",sizeY:"item.widgetInfo.sizeY",row:"item.widgetInfo.row",col:"item.widgetInfo.col",minSizeY:"item.minSizeY",maxSizeY:"item.maxSizeY"},e.standardItems2=[{attributes:{name:"box1",widgetInfo:{sizeX:6,sizeY:1,row:0,col:0}}},{attributes:{name:"box2",widgetInfo:{sizeX:2,sizeY:2,row:0,col:2}}}],e.executeButton=function(e){i.emit("publish",{topic:"pub/"+g+"/"+e.thingId,payload:e.payload})},e.saveWidgets=function(){angular.forEach(e.standardItems,function(e,t){var n={widgetInfo:e.widgetInfo};s.updateWidgetById(g,e._id,n).then(function(e){},function(e){})}),e.alertShow=!0,e.alertMessage={message:"Successfully Saved!",type:"success"},c(function(){e.alertShow=!1},2e3)},e.addThing=function(e){var t=n.open({animation:!1,templateUrl:"templates/widgetModal.html",controller:"WidgetModalCtrl",resolve:{items:function(){return!1}}});t.result.then(function(e){u(e)},function(){})},e.openSettings=function(e){var t=n.open({animation:!1,templateUrl:"templates/widgetModal.html",controller:"WidgetModalCtrl",resolve:{items:function(){return e}}});t.result.then(function(e){f(e)},function(){})}}angular.module("RDash").controller("DashboardCtrl",["$scope","$cookieStore","$uibModal","thingService","socket","lodash","widgetService","$localStorage","$timeout",DashboardCtrl]);
function LogCtrl(t,o,n,e,r,i,a,g,c){function l(o){n.getLogByThingId(t.thingId).then(function(o){t.logs=o},function(t){})}var u="";t.thingId=c.params.thingId,a.currentUser&&(u=a.currentUser.info.id),l(),t.formatDate=function(t){var o=new Date(t);return o=o.toString()}}angular.module("RDash").controller("LogCtrl",["$scope","$uibModal","logService","socket","lodash","widgetService","$localStorage","$timeout","$state",LogCtrl]);
function MasterCtrl(e,n,o,i,s,r,t){var a=992;e.user={name:"",email:"",password:""},e.isLoggedIn=!1,i.currentUser?(e.isLoggedIn=!0,e.username=i.currentUser.info.name,e.userId=i.currentUser.info.id,e.email=i.currentUser.info.email):e.username="pipeero",e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(o,i){o>=a?angular.isDefined(n.get("toggle"))?e.toggle=!!n.get("toggle"):e.toggle=!0:e.toggle=!1}),e.showRegisterForm=function(){e.isRegisterForm=!0},e.hideRegisterForm=function(){e.isRegisterForm=!1},e.doLogin=function(){e.isLoginLoading=!0,o.login(e.user).then(function(n){e.isLoginLoading=!1,n.success?(i.currentUser={info:n.data,token:n.token},s.defaults.headers.common["x-access-token"]=n.token,e.username=i.currentUser.info.name,e.userId=i.currentUser.info.id,e.email=i.currentUser.info.email,r.path("/dashboard"),e.isLoggedIn=!0):(e.invalidLoginToaster=!0,e.loginAlertMessage={message:n.message})},function(e){console.log(e)})},e.doRegister=function(){e.isRegisterLoading=!0,o.signup(e.user).then(function(n){if(e.isRegisterLoading=!1,n.errors){e.invalidLoginToaster=!0;var t="";t=n.errors.password?"Invalid Password":"Email address already taken, or might be invalid.",e.loginAlertMessage={message:t}}else{var a={email:n.email,password:n.password};o.login(a).then(function(n){e.isRegisterLoading=!1,n.success?(i.currentUser={info:n.data,token:n.token},s.defaults.headers.common["x-access-token"]=n.token,e.username=i.currentUser.info.name,e.userId=i.currentUser.info.id,e.email=i.currentUser.info.email,r.path("/dashboard"),e.isLoggedIn=!0,e.isLoginLoading=!1):(e.invalidLoginToaster=!0,e.loginAlertMessage={message:n.message},e.isLoginLoading=!1)},function(e){console.log(e)})}},function(n){e.isRegisterLoading=!1})},e.doLogout=function(){delete i.currentUser,s.defaults.headers.common["x-access-token"]="",e.isLoggedIn=!1,r.path("/login"),e.username="pipeero",t.location.reload()},e.closeLoginAlert=function(){e.invalidLoginToaster=!1},e.toggleSidebar=function(){e.toggle=!e.toggle,n.put("toggle",e.toggle)},window.onresize=function(){e.$apply()}}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","authenticationService","$localStorage","$http","$location","$window",MasterCtrl]);
function SettingCtrl(e,r,n,o,a){console.log("settings!"),e.form={},n.currentUser&&(e.form.name=n.currentUser.info.name,e.form.userId=n.currentUser.info.id,e.form.email=n.currentUser.info.email,e.form.password="as72419xc0592",e.form.password2="as72419xc0592"),e.updateUser=function(){var r={name:e.form.name,email:e.form.email};"as72419xc0592"!==e.form.password?e.form.password===e.form.password2?(r.password=e.form.password,o.updateUserById(n.currentUser.info.id,r).then(function(r){e.form.name=r.name,e.form.email=r.email,n.currentUser.info.name=r.name,n.currentUser.info.email=r.email,a.location.reload()},function(e){})):(e.settingsToaster=!0,e.settingsToasterMsg={msg:"Password did not match."}):o.updateUserById(n.currentUser.info.id,r).then(function(r){e.form.name=r.name,e.form.email=r.email,n.currentUser.info.name=r.name,n.currentUser.info.email=r.email,a.location.reload()},function(e){})},e.closeSettingsToaster=function(){e.settingsToaster=!1}}angular.module("RDash").controller("SettingCtrl",["$scope","thingService","$localStorage","authenticationService","$window",SettingCtrl]);
function ThingCtrl(n,e,t,o,i,l,r,c){function u(e){delete e["delete"],console.log(e),e.owner=s,t.createThing(e).then(function(e){n.alertMessage={message:"Successfully Added a Widget",type:"success"},d()},function(n){})}function a(n){if(n["delete"])console.log("delete!"),console.log(n),t.deleteThingById(s,n.id,n).then(function(n){d()},function(n){console.log("error")});else{console.log(n);var e=n.id;delete n.id,t.updateThingById(s,e,n).then(function(n){d()},function(n){})}}function d(e){t.getThingByUserId(s).then(function(e){console.log(e),n.things=e},function(n){})}var s="";r.currentUser&&(s=r.currentUser.info.id),d(),n.editThing=function(n){var t=e.open({animation:!1,templateUrl:"templates/thingModal.html",controller:"ThingModalCtrl",resolve:{items:function(){return n}}});t.result.then(function(n){a(n),console.log(n)},function(){})},n.deleteThing=function(n){l.getWidgetByThingId(s,n._id).then(function(t){var o=!1,i={id:n._id,"delete":!0};t.length>0&&(o=!0);var l=e.open({animation:!1,templateUrl:"templates/confirmationModal.html",controller:"ConfirmationModalCtrl",resolve:{items:function(){return o}}});l.result.then(function(n){n.confirmation&&a(i)},function(){})},function(n){})},n.addThing=function(){var n=e.open({animation:!1,templateUrl:"templates/thingModal.html",controller:"ThingModalCtrl",resolve:{items:function(){return!1}}});n.result.then(function(n){u(n)},function(){})}}angular.module("RDash").controller("ThingCtrl",["$scope","$uibModal","thingService","socket","lodash","widgetService","$localStorage","$timeout",ThingCtrl]);
function ThingModalCtrl(o,l,e,n,i){console.log(e),console.log("items"),e?o.form={id:e._id,name:e.name}:o.form={},o.save=function(){console.log("save"),l.close(o.form),o.form["delete"]=!1},o.dismiss=function(){l.dismiss("cancel")}}angular.module("RDash").controller("ThingModalCtrl",["$scope","$uibModalInstance","items","thingService","$localStorage",ThingModalCtrl]);
function WidgetModalCtrl(e,n,t,o,i){var a=i.currentUser.info.id;o.getThingByUserId(a).then(function(n){console.log(n),e.things=n},function(e){}),"object"!=typeof t&&(e.showDeleteButton=!0,console.log("hey")),e.data={availableOptions:[{id:"1",name:"Input"},{id:"2",name:"Output"}],selectedOption:{id:"1",name:"Input"}},e.ngModelOptionsSelected=function(e){return arguments.length?void(_selected=e):_selected},t?e.form={id:t._id,name:t.name,description:t.description,thingId:t.thingId,buttonLabel:t.buttonLabel,payload:t.payload,thingType:t.thingType,inputUnit:t.inputUnit}:e.form={},angular.forEach(e.data.availableOptions,function(n){n.name===t.thingType&&(e.data.selectedOption=n)}),e.generateThing=function(){var n={name:"default",owner:a,value:"default"};o.createThing(n).then(function(n){console.log(n),e.form.thingId=n._id},function(e){console.log("error")})},e.remove=function(){n.close(e.form),e.form["delete"]=!0},e.save=function(){console.log(e.form),e.form.name&&(e.form.thingType=e.data.selectedOption.name,n.close(e.form),e.form["delete"]=!1)},e.dismiss=function(){n.dismiss("cancel")}}angular.module("RDash").controller("WidgetModalCtrl",["$scope","$uibModalInstance","items","thingService","$localStorage",WidgetModalCtrl]);
function justGage(i){return{restrict:"EA",scope:{id:"@","class":"@",min:"=",max:"=",title:"@",value:"=",options:"="},template:'<div id="{{id}}-justgage" class="{{class}}"></div>',link:function(t,e,a){i(function(){var i={id:t.id+"-justgage",min:t.min,max:t.max,title:t.title,value:t.value};if(t.options)for(var e in t.options)i[e]=t.options[e];var a=new JustGage(i);t.$watch("max",function(i){void 0!==i&&a.refresh(t.value,i)},!0),t.$watch("value",function(i){void 0!==i&&a.refresh(i)},!0)},1e3)}}}angular.module("RDash").directive("justGage",["$timeout",justGage]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);
angular.module("RDash").service("authenticationService",["$q","$http","$localStorage",function(e,r,t){function o(t){var o=e.defer();return r.post(u+"/pipe/authenticate",t).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function n(t){var o=e.defer();return r.post(u+"/pipe/user",t).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function s(t,o){var n=e.defer();return r.put(u+"/pipe/user/"+t,o).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function i(){delete t.currentUser,r.defaults.headers.common.Authorization=""}var u="https://pipeero-rest-api.herokuapp.com",c={};return getUsers=function(t){var o=e.defer();return r.get(u+"/pipe/user").success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get Widgets")}),o.promise},c.login=o,c.signup=n,c.getUsers=getUsers,c.updateUserById=s,c.Logout=i,c}]);
angular.module("RDash").service("logService",["$q","$http","$window",function(e,r){function t(t){var i=e.defer();return r.get(o+"/pipe/log/"+t).success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get the ")}),i.promise}var o="https://pipeero-rest-api.herokuapp.com";return{getLogByThingId:t}}]);
angular.module("RDash").factory("socket",["socketFactory","$window",function(o){return o({prefix:"foo~",ioSocket:io.connect("https://pipeero-mqtt-ws.herokuapp.com")})}]);
angular.module("RDash").service("thingService",["$q","$http","$window",function(e,t){function r(r){var n=e.defer();return t.get(c+"/pipe/"+r+"/thing/").success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function n(r){var n=e.defer();return t.post(c+"/pipe/thing/",r).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function i(r,n,i){var o=e.defer();return t.put(c+"/pipe/"+r+"/thing/"+n,i).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function o(r,n,i){var o=e.defer();return console.log("delete thing!"),t["delete"](c+"/pipe/"+r+"/thing/"+n).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}var c="https://pipeero-rest-api.herokuapp.com";return{getThingByUserId:r,createThing:n,updateThingById:i,deleteThingById:o}}]);
angular.module("RDash").service("widgetService",["$http","$q",function(e,t){function r(r){var i=t.defer();return e.get(s+"/pipe/"+r+"/widget").success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get Widgets")}),i.promise}function i(r,i){var o=t.defer();return e.get(s+"/pipe/"+r+"/widgetByThing/"+i).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}function o(r,i,o){var n=t.defer();return e.put(s+"/pipe/"+r+"/widget/"+i,o).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function n(r,i,o){var n=t.defer();return console.log("delete widget!"),e["delete"](s+"/pipe/"+r+"/widget/"+i).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get the ")}),n.promise}function c(r,i){var o=t.defer();return e.post(s+"/pipe/widget/",i).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get the ")}),o.promise}var s="https://pipeero-rest-api.herokuapp.com",u={getWidgets:r,updateWidgetById:o,createWidget:c,deleteWidgetById:n,getWidgetByThingId:i};return u}]);